<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>n-spreadsheet</title>
</head>
<body onload="load()" style="overflow: hidden;padding: 0;margin: 0">
<div style="width: 100%;height: 100vh;resize: both;overflow: hidden;display: flex">
    <div>test position offset</div>
    <div style="resize: both;overflow: hidden;display: flex;flex-flow: column nowrap">
        <div>

            <span>12121</span><br />
        </div>
        <div id="main" style="width: 100%;height: 100%"></div>
        <div>
            <span>12121</span><br />
            <span>12121</span><br />
            <span>12121</span><br />
            <span>12121</span><br />
            <span>12121</span><br />
            <span>12121</span><br />
        </div>
    </div>
</div>
<script>
  var data = {"scale":1,"name":"三公经费录入","freeze":"B5","styles":[{"bgcolor":"#f4f5f8","textwrap":true,"color":"#900b09","border":{"top":["thick","rgba(100,100,100,0.5)"],"bottom":["thick","#0366d6"],"right":["thick","#0366d6"],"left":["thick","#0366d6"]}},{"format":"percent"},{"format":"usd"},{"format":"date"},{"format":"time"},{"format":"datetime"},{"bgcolor":"#d5dce4"},{"border":{"bottom":["thick","#000"],"top":["thick","#000"],"left":["thick","#dd0024"],"right":["thick","#dd0024"]}},{"align":"center"},{"font":{"italic":true}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]}},{"font":{"italic":true},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center"},{"font":{"italic":true},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle"},{"align":"center","valign":"middle"},{"font":{"italic":true},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"font":{"size":12}},{"font":{"size":12}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle","font":{"size":12}},{"align":"center","valign":"middle","font":{"size":12}},{"font":{"italic":true,"size":12},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle","font":{"size":12,"bold":true}},{"align":"center","valign":"middle","font":{"size":12,"bold":true}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"font":{"size":12,"name":"宋体"}},{"font":{"size":12,"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle","font":{"size":12,"bold":true,"name":"宋体"}},{"align":"center","valign":"middle","font":{"size":12,"bold":true,"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle","font":{"size":12,"name":"宋体"}},{"align":"center","valign":"middle","font":{"size":12,"name":"宋体"}},{"font":{"italic":true,"size":12,"name":"宋体"},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"valign":"middle"},{"valign":"middle"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"font":{"size":12,"name":"宋体"},"align":"center"},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"right","valign":"middle","font":{"size":12,"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"right"},{"align":"right"},{"font":{"italic":true,"size":12,"name":"宋体"},"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"right","valign":"middle"},{"align":"center","font":{"name":"宋体"}},{"font":{"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"center","valign":"middle","font":{"name":"宋体"}},{"align":"center","valign":"middle","font":{"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"right","font":{"name":"宋体"}},{"align":"right","font":{"name":"宋体"}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"font":{"name":"宋体"}},{"align":"center","font":{"name":"宋体","size":12}},{"border":{"bottom":["thin","#000"],"top":["thin","#000"],"left":["thin","#000"],"right":["thin","#000"]},"align":"right","font":{"name":"宋体","size":12}},{"align":"right","font":{"name":"宋体","size":12}}],"merges":["B3:B4","A3:A4","A5:A6","A7:A8","A9:A10","A11:A12","A13:A14","A15:A16","A17:A18","C3:F3","G3:G4","B13:G13","B14:G14","G5:G6","G7:G8","G9:G10","G11:G12","G15:G16","G17:G18","B1:G1","B2:G2","B19:G19"],"rows":{"0":{"cells":{"0":{"text":"选择月份","style":33},"1":{"style":33,"merge":[0,5]},"2":{"style":45},"3":{"style":45},"4":{"style":45},"5":{"style":45},"6":{"style":45}},"height":29},"1":{"cells":{"0":{"text":"单位名称","style":33},"1":{"text":"","style":33,"merge":[0,5]},"2":{"style":45},"3":{"style":45},"4":{"style":45},"5":{"style":45},"6":{"style":45}},"height":26,"hide":true},"2":{"cells":{"0":{"text":"项目名称","style":26,"merge":[1,0]},"1":{"text":"支出类型","style":26,"merge":[1,0]},"2":{"text":"资金性质","style":26,"merge":[0,3]},"3":{"style":25},"4":{"style":25},"5":{"style":25},"6":{"style":26,"merge":[1,0],"text":"合计"}}},"3":{"cells":{"0":{"style":27},"1":{"style":26},"2":{"text":"一般公共预算","style":26},"3":{"text":"政府性基金","style":26},"4":{"text":"专户资金","style":26},"5":{"text":"其他来源","style":26},"6":{"style":27}}},"4":{"cells":{"0":{"text":"因公出国（境）费用","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"style":34},"4":{"style":34},"5":{"style":34},"6":{"style":46,"merge":[1,0],"formula":"C5+C6+D5+D6+E5+E6+F5+F6","editable":true}},"height":18},"5":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"style":34},"4":{"style":34},"5":{"style":34},"6":{"style":47}}},"6":{"cells":{"0":{"text":"公务用车购置费","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"text":"","style":34},"6":{"style":46,"merge":[1,0],"formula":"C7+C8+D7+D8+E7+E8+F7+F8","text":2,"editable":false}}},"7":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":34},"6":{"style":47}}},"8":{"cells":{"0":{"text":"公务用车运行维护费","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"text":"","style":34},"6":{"style":46,"merge":[1,0],"formula":"C9+C10+D9+D10+E9+E10+F9+F10","text":2,"editable":false}}},"9":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":34},"6":{"style":47}}},"10":{"cells":{"0":{"text":"公务接待费","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"text":"","style":34},"6":{"style":46,"merge":[1,0],"formula":"C11+C12+D11+D12+E11+E12+F11+F12","text":2,"editable":false}}},"11":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":34},"6":{"style":47}}},"12":{"cells":{"0":{"text":"公务接待批次","style":28,"merge":[1,0]},"1":{"text":"","style":28,"merge":[0,5]},"2":{"style":45},"3":{"style":45},"4":{"style":45},"5":{"style":45},"6":{"style":45}}},"13":{"cells":{"0":{"style":29},"1":{"text":"","style":28,"merge":[0,5]},"2":{"style":45},"3":{"style":45},"4":{"style":45},"5":{"style":45},"6":{"style":45}}},"14":{"cells":{"0":{"text":"培训费","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"text":"","style":34},"6":{"style":46,"merge":[1,0],"formula":"C15+C16+D15+D16+E15+E16+F15+F16","text":2,"editable":false}}},"15":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":34},"6":{"style":47}}},"16":{"cells":{"0":{"text":"会议费","style":28,"merge":[1,0]},"1":{"text":"基本支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":37,"text":""},"6":{"style":46,"merge":[1,0],"formula":"C17+C18+D17+D18+E17+E18+F17+F18","text":2,"editable":false}}},"17":{"cells":{"0":{"style":29},"1":{"text":"项目支出","style":28},"2":{"style":34},"3":{"text":"","style":34},"4":{"text":"","style":34},"5":{"style":34},"6":{"style":47}}},"18":{"cells":{"0":{"text":"调整原因","style":33},"1":{"merge":[0,5],"style":24},"2":{"style":25},"3":{"style":25},"4":{"style":25},"5":{"style":25},"6":{"style":25}},"height":46},"len":19},"cols":{"0":{"width":177},"1":{"width":74},"2":{"width":114},"3":{"width":92},"4":{"width":81},"5":{"width":74},"len":7},"validations":[{"refs":["C5:F18"],"mode":"cell","type":"number","required":false,"operator":"be","value":[0,999999999999]},{"refs":["B13:B14"],"mode":"cell","type":"number","required":true,"operator":"be","value":[0,999999999999]},{"refs":["B1"],"mode":"cell","type":"list","required":false,"operator":"be","value":"1,2,3,4,5,6,7,8,9,10,11,12"}],"autofilter":{}};
  var xs;
  function load() {
    xs = $.spreadsheet('#main', {
      privileges: {
        editable: true, // 编辑数据
        dataEdit: true,
        dataFormat: true,
      },
    })
      .loadData([data
      // {
      //   'name': 'sheet1',
      //   //设置冻结行和列的右下角单元格，例如B3表示冻结第1，2行和A列
      //   'freeze': 'B3',
      //   //定义所有用到的样式
      //   'styles': [{
      //     'bgcolor': '#f4f5f8',
      //     'textwrap': true,
      //     'color': '#900b09',
      //     'border': {
      //       'top': ['thin', '#0366d6'],
      //       'bottom': ['thin', '#0366d6'],
      //       'right': ['thin', '#0366d6'],
      //       'left': ['thin', '#0366d6']
      //     }
      //   }, {
      //     //百分比样式
      //     'format': 'percent'
      //   }, {
      //     //美元样式
      //     'format': 'usd'
      //   }, {
      //     'format': 'date'
      //   }, {
      //     'format': 'time'
      //   }, {
      //     'format': 'datetime'
      //   }, {
      //     //背景色样式
      //     'bgcolor': '#d5dce4'
      //   }, {
      //     //边框样式
      //     'border': {
      //       'bottom': ['thin', '#000'],
      //       'top': ['thin', '#000'],
      //       'left': ['thin', '#000'],
      //       'right': ['thin', '#000']
      //     }
      //   }, {
      //     //居中样式
      //     'align': 'center'
      //   }],
      //   //所有的合并单元格区域
      //   'merges': ['B13:D14'],
      //   //定义表格内单元格的数据
      //   'rows': {
      //     '0':{
      //       'cells':{
      //         '0':{}
      //       }
      //     },
      //     '1': {
      //       'cells': {
      //         '0': {},
      //         '2': {}
      //       }
      //     },
      //     '2': {
      //       'cells': {
      //         '0': {},
      //         '1': { 'text': '1' },
      //         '2': {}
      //       }
      //     },
      //     //百分比格式示例
      //     '3': {
      //       'cells': {
      //         '1': {
      //           'text': '1',
      //           //对应样式表中序号
      //           'style': 1
      //         }
      //       }
      //     },
      //     //美元格式示例
      //     '4': {
      //       'cells': {
      //         '1': {
      //           'text': '1',
      //           'style': 2
      //         }
      //       }
      //     },
      //     '5': { 'cells': { '1': { 'style': 5 } } },
      //     //背景色示例
      //     '6': {
      //       'cells': {
      //         '1': {
      //           'style': 6,
      //           'text': '填充色'
      //         },
      //         '2': { 'style': 6 },
      //         '3': { 'style': 6 }
      //       }
      //     },
      //     '7': {
      //       'cells': {
      //         '1': { 'style': 6 },
      //         '2': { 'style': 6 },
      //         '3': { 'style': 6 },
      //         '5': {
      //           'text': '数据格式：（数字）',
      //           //不允许编辑（锁定单元格）示例
      //           'editable': false
      //         },
      //         '6': { 'text': '100' }
      //       }
      //     },
      //     //边框示例
      //     '8': {
      //       'cells': {
      //         '1': {
      //           'text': '边框',
      //           'style': 7
      //         },
      //         '2': { 'style': 7 },
      //         '3': { 'style': 7 },
      //         '8': {}
      //       }
      //     },
      //     '9': {
      //       'cells': {
      //         '1': { 'style': 7 },
      //         '2': { 'style': 7 },
      //         '3': { 'style': 7 }
      //       }
      //     },
      //     '12': {
      //       'cells': {
      //         '1': {
      //           //表示合并单元格的大小（比较奇葩。1，2表示2行3列，例2，3表示3行4列）
      //           'merge': [1, 2],
      //           'text': '合并并居中',
      //           //居中样式示例
      //           'style': 8
      //         },
      //         '2': { 'style': 8 },
      //         '3': { 'style': 8 }
      //       }
      //     },
      //     '13': {
      //       'cells': {
      //         '1': { 'style': 8 },
      //         '2': { 'style': 8 },
      //         '3': { 'style': 8 }
      //       }
      //     },
      //     //定义当前表格总行数
      //     'len': 300
      //   },
      //   'cols': {
      //     //定义某个特定的列宽，此处为第6列列宽200
      //     '5': { 'width': 200 },
      //     //定义当前表格总列数
      //     'len': 126
      //   },
      //   //设置某单元格数据验证规则
      //   'validations': [{
      //     'refs': ['G8'],
      //     'mode': 'cell',
      //     'type': 'number',
      //     'required': false,
      //     'operator': 'be',
      //     'value': ['1', '100']
      //   }],
      //   'autofilter': {}
      // }
      ])//表格内容发生变动时的回调方法
      .change(function(cdata,datas){
        window.datas = datas;
        //cdata是当前sheet表格数据，再次可以根据数据做一些事情
        console.log(cdata,datas);
        console.log(Object.keys(cdata.getData()));
        window.xe = () => {
          const exporter = new window.$.excel.exporter();
          exporter.setData(datas);
          exporter.exportWithBuffer().then(data=>{
            const blob = new Blob([data],{type : 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
            const blobUrl = URL.createObjectURL(blob);
            const eleLink = document.createElement('a')
            eleLink.download = '1.xlsx'
            eleLink.style.display = 'none'
            eleLink.href = blobUrl
            // 触发点击
            document.body.appendChild(eleLink)
            eleLink.click()
            // 然后移除
            document.body.removeChild(eleLink)
          });
        }
      }).on('cells-selected', function(...args){
        console.log(args);
      }).on('cell-selected', function(...args){
        console.log(...args);
      }).setCustomMenu([
        {
          key:'test',
          title:'测试',
          handler:(key,target,sheet)=>{
            console.log(key,target,sheet)
            }
        }
      ]);
  }
</script>
</body>
</html>
